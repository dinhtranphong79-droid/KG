<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Web Tá»•ng Há»£p - Accounts</title>
<style>
body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:#f3f4f6}
.header{display:flex;align-items:center;gap:12px;padding:12px;background:#fff;border-bottom:1px solid #ddd;position:sticky;top:0;z-index:100}
.menu-btn{padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600;color:#374151;border:1px solid transparent}
.menu-btn.active{background:#2563eb;color:#fff;border-color:#1d4ed8}
.spacer{flex:1}
select,input{padding:6px 10px;border-radius:6px;border:1px solid #ccc}
.add-btn{padding:6px 10px;border-radius:6px;background:#10b981;color:#fff;border:none;cursor:pointer}
.tab-page{display:none}
.tab-page.active{display:block}
iframe{width:100%;min-height:calc(100vh - 70px);border:0;background:#fff}
.total-container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.06)}
.point-row{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #eee;font-size:18px}
.point-row.total{font-weight:700;font-size:20px;border-bottom:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center}
.modal .box{background:#fff;padding:18px;border-radius:10px;min-width:320px}
.small{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>

<div class="header">
  <div id="tabP" class="menu-btn active" data-tab="phao">ğŸ”¥ PhÃ¡o</div>
  <div id="tabT" class="menu-btn" data-tab="tuong">ğŸ›¡ï¸ TÆ°á»›ng</div>
  <div id="tabW" class="menu-btn" data-tab="witch">ğŸ”® Witch</div>
  <div id="tabS" class="menu-btn" data-tab="tong">â­ Tá»•ng Ä‘iá»ƒm</div>

  <div class="spacer"></div>

  <label for="accSelect">TÃ i khoáº£n</label>
  <select id="accSelect" style="min-width:180px"></select>
  <button class="add-btn" id="btnAdd">+ ThÃªm</button>
  <div style="width:12px"></div>
  <button id="btnSwitch" style="padding:6px 10px;border-radius:6px;background:#2563eb;color:#fff;border:none;cursor:pointer">Chá»n</button>
</div>

<!-- Tabs -->
<div id="page-phao" class="tab-page active"><iframe id="iframeP" src="phao.html"></iframe></div>
<div id="page-tuong" class="tab-page"><iframe id="iframeT" src="tuong.html"></iframe></div>
<div id="page-witch" class="tab-page"><iframe id="iframeW" src="witch.html"></iframe></div>

<div id="page-tong" class="tab-page">
  <div class="total-container">
    <h2 style="text-align:center">Tá»•ng Ä‘iá»ƒm</h2>
    <div class="point-row"><span>ğŸ”¥ Äiá»ƒm PhÃ¡o</span><span id="pPhao">0</span></div>
    <div class="point-row"><span>ğŸ›¡ï¸ Äiá»ƒm TÆ°á»›ng</span><span id="pTuong">0</span></div>
    <div class="point-row"><span>ğŸ”® Äiá»ƒm Witch</span><span id="pWitch">0</span></div>
    <div class="point-row total"><span>â­ Tá»•ng</span><span id="pTong">0</span></div>
    <div class="small">Chá»n tÃ i khoáº£n Ä‘á»ƒ hiá»ƒn thá»‹ Ä‘iá»ƒm tÆ°Æ¡ng á»©ng. Äiá»ƒm Ä‘Æ°á»£c lÆ°u tá»± Ä‘á»™ng theo tá»«ng tÃ i khoáº£n.</div>
  </div>
</div>

<!-- Add account modal -->
<div id="modal" class="modal"><div class="box">
  <h3>ThÃªm tÃ i khoáº£n má»›i</h3>
  <input id="newAcc" placeholder="Nháº­p tÃªn tÃ i khoáº£n" style="width:100%;margin-top:8px"/>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
    <button id="btnCancel" style="padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#fff">Há»§y</button>
    <button id="btnSaveAcc" style="padding:6px 10px;border-radius:6px;background:#10b981;color:#fff;border:none">LÆ°u</button>
  </div>
</div></div>

<script>
const DEFAULT_ACCOUNTS = ["minhlannÃ¨","minhlannhá»","Dolvar","DolvarAsh","DolvarAegis","DolvarReign","DolvarReaper","DolvarTroth","DolvarBasion"];
const ACC_LIST_KEY = "acc_list_v1";
let accounts = JSON.parse(localStorage.getItem(ACC_LIST_KEY) || 'null') || DEFAULT_ACCOUNTS.slice();
localStorage.setItem(ACC_LIST_KEY, JSON.stringify(accounts));

const accSelect = document.getElementById("accSelect");
const modal = document.getElementById("modal");
const newAccInput = document.getElementById("newAcc");
let currentAcc = localStorage.getItem("current_acc") || accounts[0];
let points = {phao:0, tuong:0, witch:0};

function refreshAccountUI(){
    accSelect.innerHTML = "";
    accounts.forEach(a=>{
        const opt = document.createElement("option"); opt.value = a; opt.textContent = a;
        accSelect.appendChild(opt);
    });
    accSelect.value = currentAcc || accounts[0];
}
refreshAccountUI();

document.getElementById("btnAdd").addEventListener("click", ()=>{ modal.style.display = "flex"; newAccInput.value=""; newAccInput.focus(); });
document.getElementById("btnCancel").addEventListener("click", ()=>{ modal.style.display = "none"; });
document.getElementById("btnSaveAcc").addEventListener("click", ()=>{
    const name = newAccInput.value.trim();
    if(!name) return alert("Nháº­p tÃªn tÃ i khoáº£n");
    if(accounts.includes(name)) return alert("TÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i");
    accounts.push(name);
    localStorage.setItem(ACC_LIST_KEY, JSON.stringify(accounts));
    modal.style.display = "none";
    currentAcc = name;
    localStorage.setItem("current_acc", currentAcc);
    refreshAccountUI();
    broadcastAccChange();
});

document.getElementById("btnSwitch").addEventListener("click", ()=>{
    const sel = accSelect.value;
    if(!sel) return;
    currentAcc = sel;
    localStorage.setItem("current_acc", currentAcc);
    broadcastAccChange();
    alert("ÄÃ£ chá»n tÃ i khoáº£n: " + currentAcc);
});

/* tabs switching */
const tabs = document.querySelectorAll(".menu-btn");
tabs.forEach(t=>t.addEventListener("click", ()=>{
    tabs.forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    document.querySelectorAll(".tab-page").forEach(p=>p.classList.remove("active"));
    document.getElementById("page-" + t.dataset.tab).classList.add("active");
}));

/* messaging with iframes */
const ifrP = document.getElementById("iframeP");
const ifrT = document.getElementById("iframeT");
const ifrW = document.getElementById("iframeW");

function broadcastAccChange(){
    const msg = {type:"acc_changed", acc: currentAcc};
    try { ifrP.contentWindow.postMessage(msg, "*"); } catch(e){}
    try { ifrT.contentWindow.postMessage(msg, "*"); } catch(e){}
    try { ifrW.contentWindow.postMessage(msg, "*"); } catch(e){}
    setTimeout(()=> {
        try { ifrP.contentWindow.postMessage({type:"request_point"}, "*"); } catch(e){}
        try { ifrT.contentWindow.postMessage({type:"request_point"}, "*"); } catch(e){}
        try { ifrW.contentWindow.postMessage({type:"request_point"}, "*"); } catch(e){}
    }, 300);
}

window.addEventListener("message", e=>{
    const d = e.data || {};
    if(d && d.type === "updatePoint" && typeof d.tab === "string"){
        points[d.tab] = Number(d.value) || 0;
        updateTotalsInUI();
        try { localStorage.setItem("acc_" + currentAcc + "_points", JSON.stringify(points)); } catch(e){}
    }
    if(d && d.type === "ready"){
        try { e.source.postMessage({type:"acc_changed", acc: currentAcc}, "*"); } catch(e){}
        try { e.source.postMessage({type:"request_point"}, "*"); } catch(e){}
    }
});

function restorePointsForAcc(){
    const raw = localStorage.getItem("acc_" + currentAcc + "_points");
    if(raw){
        try { points = JSON.parse(raw); } catch(e){ points = {phao:0,tuong:0,witch:0}; }
    } else { points = {phao:0,tuong:0,witch:0}; }
    updateTotalsInUI();
}
function updateTotalsInUI(){
    document.getElementById("pPhao").textContent = (points.phao||0).toLocaleString("vi-VN");
    document.getElementById("pTuong").textContent = (points.tuong||0).toLocaleString("vi-VN");
    document.getElementById("pWitch").textContent = (points.witch||0).toLocaleString("vi-VN");
    document.getElementById("pTong").textContent = ((points.phao||0)+(points.tuong||0)+(points.witch||0)).toLocaleString("vi-VN");
}

window.addEventListener("load", ()=>{
    restorePointsForAcc();
    broadcastAccChange();
});
</script>
</body>
</html>
